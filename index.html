<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Innovation Management ‚Äì AI Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-body: #020617;         /* page background */
      --bg-panel: #020617;        /* outer panel */
      --bg-chat: #020617;         /* inner chat background */
      --border-subtle: #1e293b;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --user-bubble: #38bdf8;
      --assistant-bubble: #0f172a;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --radius-lg: 1.5rem;
      --radius-md: 1rem;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.55);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .app-shell {
      max-width: 900px;
      width: 100%;
    }

    .chat-panel {
      background: linear-gradient(145deg, #020617, #020617);
      border-radius: 2rem;
      box-shadow: var(--shadow-soft);
      padding: 20px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      backdrop-filter: blur(16px);
    }

    .chat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 8px 4px 16px;
      border-bottom: 1px solid var(--border-subtle);
      margin-bottom: 16px;
    }

    .chat-header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #e0f2fe, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #020617;
      font-size: 18px;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.6);
    }

    .title-block h1 {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    .title-block p {
      font-size: 12px;
      color: var(--text-muted);
    }

    .badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: radial-gradient(circle at top left, #1d283a, #020617);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.09em;
      white-space: nowrap;
    }

    .chat-body {
      background: var(--bg-chat);
      border-radius: 1.5rem;
      border: 1px solid var(--border-subtle);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 380px;
      max-height: 520px;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      scrollbar-width: thin;
      scrollbar-color: #4b5563 transparent;
    }

    .messages::-webkit-scrollbar {
      width: 6px;
    }
    .messages::-webkit-scrollbar-track {
      background: transparent;
    }
    .messages::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 999px;
    }

    .message-row {
      display: flex;
      gap: 8px;
    }

    .message-row.user {
      justify-content: flex-end;
    }

    .message-row.assistant {
      justify-content: flex-start;
    }

    .message-bubble {
      max-width: 80%;
      padding: 9px 13px;
      border-radius: 999px;
      font-size: 14px;
      line-height: 1.35;
      white-space: pre-wrap;
      word-wrap: break-word;
      position: relative;
    }

    .message-row.user .message-bubble {
      background: var(--user-bubble);
      color: #0f172a;
      border-bottom-right-radius: 4px;
    }

    .message-row.assistant .message-bubble {
      background: var(--assistant-bubble);
      border: 1px solid var(--border-subtle);
      color: var(--text-main);
      border-bottom-left-radius: 4px;
    }

    .meta-row {
      display: flex;
      justify-content: center;
      margin: 2px 0 6px;
    }

    .meta-text {
      font-size: 11px;
      color: var(--text-muted);
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(51, 65, 85, 0.9);
    }

    .chat-footer {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .helper-text {
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }

    .helper-text span {
      display: inline-block;
    }

    .helper-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(56, 189, 248, 0.7);
    }

    form {
      display: flex;
      align-items: stretch;
      gap: 8px;
      margin-top: 4px;
    }

    textarea {
      flex: 1;
      resize: none;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      padding: 10px 14px;
      font-size: 14px;
      line-height: 1.3;
      min-height: 48px;
      max-height: 96px;
      outline: none;
    }

    textarea::placeholder {
      color: #6b7280;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 0 18px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      background: radial-gradient(circle at top left, #38bdf8, #0ea5e9);
      color: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 82px;
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out,
        filter 0.08s ease-out;
      box-shadow: 0 14px 32px rgba(56, 189, 248, 0.3);
      white-space: nowrap;
    }

    button:disabled {
      opacity: 0.55;
      cursor: default;
      box-shadow: none;
      transform: none;
      filter: grayscale(0.1);
    }

    button:not(:disabled):hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(56, 189, 248, 0.45);
      filter: brightness(1.02);
    }

    button:not(:disabled):active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(56, 189, 248, 0.4);
    }

    .send-icon {
      margin-left: 6px;
      font-size: 14px;
    }

    @media (max-width: 640px) {
      .chat-panel {
        border-radius: 1.5rem;
        padding: 16px;
      }

      .message-bubble {
        max-width: 100%;
      }

      button {
        padding: 0 14px;
        min-width: 70px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="chat-panel">
      <header class="chat-header">
        <div class="chat-header-left">
          <div class="avatar">IM</div>
          <div class="title-block">
            <h1>Innovation Management ‚Äì AI Assistant</h1>
            <p>Ask about weeks, assessments, workload or textbook (course data only).</p>
          </div>
        </div>
        <div class="badge">DEMO ¬∑ POSTGRAD</div>
      </header>

      <section class="chat-body">
        <div class="messages" id="messages"></div>
      </section>

      <footer class="chat-footer">
        <div class="helper-text">
          <span>Tip: Try ‚ÄúWhat will we cover in Week 2?‚Äù or ‚ÄúHow is Assessment 2 marked?‚Äù</span>
          <span class="helper-dot"></span>
        </div>
        <form id="chat-form">
          <textarea
            id="message-input"
            placeholder="Type your question about this Innovation Management course..."
          ></textarea>
          <button type="submit" id="send-button">
            Send
            <span class="send-icon">‚û§</span>
          </button>
        </form>
      </footer>
    </div>
  </div>

  <script>
    // üîó 1. Your live n8n webhook URL (Production)
    const webhookUrl = "https://n8n.srv1133312.hstgr.cloud/webhook/innovation-helper";

    const messagesEl = document.getElementById("messages");
    const formEl = document.getElementById("chat-form");
    const inputEl = document.getElementById("message-input");
    const sendButtonEl = document.getElementById("send-button");

    // This keeps the past turns that are sent as `memory` to the webhook
    // Shape: { role: "user" | "assistant", content: "..." }
    const memory = [];

    function appendMessage(role, text) {
      const row = document.createElement("div");
      row.className = `message-row ${role}`;

      const bubble = document.createElement("div");
      bubble.className = "message-bubble";
      bubble.textContent = text;

      row.appendChild(bubble);
      messagesEl.appendChild(row);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function appendMeta(text) {
      const row = document.createElement("div");
      row.className = "meta-row";
      const pill = document.createElement("div");
      pill.className = "meta-text";
      pill.textContent = text;
      row.appendChild(pill);
      messagesEl.appendChild(row);
      messagesEl.scrollTop = messagesEl.scrollHeight;
      return row;
    }

    async function sendToBackend(message) {
      // Add user message locally + to memory
      appendMessage("user", message);
      memory.push({ role: "user", content: message });

      // Meta ‚Äúthinking‚Äù line
      const thinkingEl = appendMeta("Assistant is thinking with the course data...");

      sendButtonEl.disabled = true;

      try {
        const response = await fetch(webhookUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            message,
            memory,
          }),
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const text = await response.text();
        messagesEl.removeChild(thinkingEl);

        appendMessage("assistant", text.trim());
        memory.push({ role: "assistant", content: text.trim() });
      } catch (error) {
        console.error(error);
        messagesEl.removeChild(thinkingEl);
        appendMessage(
          "assistant",
          "Sorry, something went wrong while talking to the course assistant. Please try again in a moment."
        );
      } finally {
        sendButtonEl.disabled = false;
      }
    }

    formEl.addEventListener("submit", (event) => {
      event.preventDefault();
      const raw = inputEl.value.trim();
      if (!raw) return;
      inputEl.value = "";
      sendToBackend(raw);
    });

    // Optional: initial greeting from assistant
    appendMessage(
      "assistant",
      "Hi, I‚Äôm the Innovation Management course assistant. You can ask about weekly topics, assessments, workload, learning outcomes or the textbook ‚Äî all based on the official course blueprint."
    );
  </script>
</body>
</html>
