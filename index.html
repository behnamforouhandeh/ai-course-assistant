<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Innovation Management ‚Äì AI Assistant</title>

<style>
  body {
    margin: 0;
    padding: 0;
    background: #0d0d0d;
    font-family: "Segoe UI", Arial, sans-serif;
    color: #fff;
    display: flex;
    justify-content: center;
    padding-top: 40px;
  }

  .container {
    width: 100%;
    max-width: 650px;
    background: #161616;
    border-radius: 16px;
    padding: 25px;
    box-shadow: 0 0 25px rgba(0,0,0,0.25);
    border: 1px solid #262626;
  }

  h2 {
    text-align: center;
    margin-top: 0;
    color: #ba68ff;
    font-weight: 600;
    letter-spacing: 0.5px;
  }

  .messages {
    background: #111;
    height: 420px;
    overflow-y: auto;
    padding: 15px;
    border-radius: 12px;
    border: 1px solid #242424;
  }

  .bubble {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 14px;
    margin-bottom: 14px;
    line-height: 1.45;
    font-size: 15px;
    animation: fadeIn 0.2s ease-in;
    white-space: pre-wrap;
  }

  .user {
    background: #7e57c2;
    margin-left: auto;
    border-bottom-right-radius: 4px;
  }

  .bot {
    background: #2b2b2b;
    border-bottom-left-radius: 4px;
    border: 1px solid #3a3a3a;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(3px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Typing indicator (three bouncing dots) */
  .typing {
    display: flex;
    gap: 6px;
    padding-left: 4px;
  }
  .dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: #ba68ff;
    animation: bounce 0.8s infinite alternate;
  }
  .dot:nth-child(2) { animation-delay: 0.15s; }
  .dot:nth-child(3) { animation-delay: 0.3s; }

  @keyframes bounce {
    from { transform: translateY(0); opacity: 0.6; }
    to { transform: translateY(-6px); opacity: 1; }
  }

  .input-area {
    margin-top: 16px;
    display: flex;
    gap: 10px;
  }

  input {
    flex: 1;
    padding: 14px;
    border-radius: 10px;
    border: 1px solid #333;
    background: #1b1b1b;
    color: #fff;
    font-size: 15px;
  }

  button {
    padding: 14px 22px;
    font-size: 15px;
    border: none;
    border-radius: 10px;
    background: #ba68ff;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
  }
  button:hover {
    background: #a84aff;
  }
</style>
</head>

<body>
<div class="container">
  <h2>üí° Innovation Management ‚Äì AI Assistant</h2>

  <div id="messages" class="messages"></div>

  <div class="input-area">
    <input id="userInput" type="text" placeholder="Ask a question about the course‚Ä¶" />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
  /* Your real webhook URL */
  const webhookURL = "https://n8n.srv1133312.hstgr.cloud/webhook/innovation-helper";

  let conversationMemory = [];

  function addBubble(text, sender) {
    const container = document.getElementById("messages");
    const bubble = document.createElement("div");
    bubble.className = "bubble " + sender;
    bubble.textContent = text;
    container.appendChild(bubble);
    container.scrollTop = container.scrollHeight;
  }

  function addTypingIndicator() {
    const container = document.getElementById("messages");
    const wrap = document.createElement("div");
    wrap.className = "bubble bot";
    wrap.id = "typingIndicator";

    const dots = document.createElement("div");
    dots.className = "typing";

    dots.appendChild(Object.assign(document.createElement("div"), { className:"dot" }));
    dots.appendChild(Object.assign(document.createElement("div"), { className:"dot" }));
    dots.appendChild(Object.assign(document.createElement("div"), { className:"dot" }));

    wrap.appendChild(dots);
    container.appendChild(wrap);
    container.scrollTop = container.scrollHeight;
  }

  function removeTypingIndicator() {
    const el = document.getElementById("typingIndicator");
    if (el) el.remove();
  }

  async function sendMessage() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;

    addBubble(text, "user");

    conversationMemory.push({ role: "user", content: text });
    input.value = "";

    addTypingIndicator();

    try {
      const response = await fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          message: text,
          memory: conversationMemory
        })
      });

      const blob = await response.blob();
      const resultText = await blob.text();

      removeTypingIndicator();

      /* guardrails (simple version) */
      const safeText = applyGuardrails(resultText);

      conversationMemory.push({ role: "assistant", content: safeText });
      addBubble(safeText, "bot");

    } catch (error) {
      removeTypingIndicator();
      addBubble("‚ö†Ô∏è Error connecting ‚Äî please try again.", "bot");
    }
  }

  /* Basic guardrails template */
  function applyGuardrails(text) {
    if (text.toLowerCase().includes("provide the full answer")
        || text.toLowerCase().includes("write my assignment")
        || text.toLowerCase().includes("complete the assessment")) {
      return "I can guide you with concepts, but I can‚Äôt complete assessments. Reach out to your tutor for academic help.";
    }
    return text;
  }
</script>

</body>
</html>
