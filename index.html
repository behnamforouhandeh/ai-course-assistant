<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Innovation Management â€“ AI Assistant</title>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 40px 12px;
      min-height: 100vh;
      background: radial-gradient(circle at top, #2b1b3f 0, #050509 45%, #000 100%);
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      color: #fff;
    }

    .shell {
      width: 100%;
      max-width: 760px;
      display: flex;
      justify-content: center;
    }

    .card {
      width: 100%;
      max-width: 640px;
      background: rgba(14, 14, 18, 0.96);
      border-radius: 20px;
      padding: 22px 22px 18px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(148, 119, 255, 0.32);
      backdrop-filter: blur(12px);
    }

    .title {
      text-align: center;
      margin: 0 0 4px;
      font-size: 20px;
      letter-spacing: 0.03em;
      color: #f3e5ff;
    }

    .subtitle {
      text-align: center;
      margin: 0 0 16px;
      font-size: 13px;
      color: #c0b6ff;
      opacity: 0.9;
    }

    .messages {
      background: #050509;
      border-radius: 16px;
      border: 1px solid #272336;
      padding: 14px 10px;
      height: 420px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .row {
      display: flex;
      width: 100%;
    }

    .row.user {
      justify-content: flex-end;
    }

    .row.bot {
      justify-content: flex-start;
    }

    .bubble {
      max-width: 82%;
      padding: 10px 14px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.55;
      white-space: pre-wrap;
      animation: fadeIn 0.18s ease-out;
      word-wrap: break-word;
      word-break: break-word;
    }

    .bubble.user {
      background: linear-gradient(135deg, #b46cff, #8a4dff);
      color: #fff;
      border-bottom-right-radius: 4px;
      box-shadow: 0 6px 16px rgba(137, 90, 255, 0.5);
    }

    .bubble.bot {
      background: #14121d;
      color: #f8f2ff;
      border: 1px solid #2f294a;
      border-bottom-left-radius: 4px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.7);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(4px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .typing-wrapper {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .dots {
      display: inline-flex;
      gap: 5px;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #c49bff;
      animation: bounce 0.8s infinite alternate;
    }

    .dot:nth-child(2) { animation-delay: 0.12s; }
    .dot:nth-child(3) { animation-delay: 0.24s; }

    @keyframes bounce {
      from { transform: translateY(1px); opacity: 0.4; }
      to   { transform: translateY(-4px); opacity: 1; }
    }

    .input-row {
      display: flex;
      gap: 10px;
      margin-top: 14px;
    }

    .input-row input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #37324b;
      background: #0d0b14;
      color: #ffffff;
      padding: 11px 14px;
      font-size: 14px;
      outline: none;
    }

    .input-row input::placeholder {
      color: #7a738f;
    }

    .input-row button {
      border-radius: 999px;
      border: none;
      padding: 11px 22px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #d66bff, #914eff);
      color: #fff;
      box-shadow: 0 6px 16px rgba(178, 110, 255, 0.6);
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out;
      white-space: nowrap;
    }

    .input-row button:hover {
      transform: translateY(-1px);
      box-shadow: 0 9px 20px rgba(178, 110, 255, 0.75);
    }

    .input-row button:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(178, 110, 255, 0.6);
    }

    @media (max-width: 600px) {
      body {
        padding: 20px 8px;
      }
      .card {
        padding: 18px 14px 14px;
      }
      .messages {
        height: 360px;
      }
    }
  </style>
</head>

<body>
  <div class="shell">
    <div class="card">
      <h2 class="title">ðŸ’¡ Innovation Management â€“ AI Assistant</h2>
      <p class="subtitle">Ask questions about weeks, assessments, and expectations based on the course data.</p>

      <div id="messages" class="messages"></div>

      <div class="input-row">
        <input id="userInput" type="text" placeholder="Ask a question about the courseâ€¦" />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

  <script>
    const webhookURL = "https://n8n.srv1133312.hstgr.cloud/webhook/innovation-helper";
    let conversationMemory = [];

    function scrollToBottom() {
      const container = document.getElementById("messages");
      container.scrollTop = container.scrollHeight;
    }

    function addBubble(text, sender) {
      const container = document.getElementById("messages");

      const row = document.createElement("div");
      row.className = "row " + sender;

      const bubble = document.createElement("div");
      bubble.className = "bubble " + sender;
      bubble.textContent = text;

      row.appendChild(bubble);
      container.appendChild(row);
      scrollToBottom();
    }

    function addTypingIndicator() {
      const container = document.getElementById("messages");

      const row = document.createElement("div");
      row.className = "row bot";
      row.id = "typingRow";

      const bubble = document.createElement("div");
      bubble.className = "bubble bot";

      const wrap = document.createElement("div");
      wrap.className = "typing-wrapper";

      const label = document.createElement("span");
      label.textContent = "Assistant is typing";

      const dots = document.createElement("div");
      dots.className = "dots";

      dots.appendChild(Object.assign(document.createElement("div"), { className: "dot" }));
      dots.appendChild(Object.assign(document.createElement("div"), { className: "dot" }));
      dots.appendChild(Object.assign(document.createElement("div"), { className: "dot" }));

      wrap.appendChild(label);
      wrap.appendChild(dots);
      bubble.appendChild(wrap);
      row.appendChild(bubble);
      container.appendChild(row);

      scrollToBottom();
    }

    function removeTypingIndicator() {
      const row = document.getElementById("typingRow");
      if (row) row.remove();
    }

    async function sendMessage() {
      const input = document.getElementById("userInput");
      const text = input.value.trim();
      if (!text) return;

      addBubble(text, "user");
      conversationMemory.push({ role: "user", content: text });
      input.value = "";

      addTypingIndicator();

      try {
        const response = await fetch(webhookURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            message: text,
            memory: conversationMemory
          })
        });

        const blob = await response.blob();
        const raw = await blob.text();

        removeTypingIndicator();

        const safe = applyGuardrails(raw);
        conversationMemory.push({ role: "assistant", content: safe });
        addBubble(safe, "bot");
      } catch (error) {
        console.error(error);
        removeTypingIndicator();
        addBubble("âš ï¸ Error connecting â€” please try again in a moment.", "bot");
      }
    }

    // Very lightweight guardrails
    function applyGuardrails(text) {
      const lower = text.toLowerCase();
      if (
        lower.includes("write the full answer") ||
        lower.includes("complete the assessment") ||
        lower.includes("do my assignment")
      ) {
        return "I can help you understand the concepts and structure your thinking, but I canâ€™t complete assessments or assignments for you. Please use this guidance to develop your own work.";
      }
      return text;
    }

    // Enter key support
    document.getElementById("userInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</body>
</html>
